#第二章 最简单的函数

最简单的函数可能就是简单的返回一个常数

就像这样

```cpp
int f()
{
	return 123;
};
```

让我们来编译它！

##2.1 x86

这是优化的GCC和MSVC编译器在x86平台上生成的结果：

```
f:
	mov eax, 123
	ret
```

只有两条指令：第一条把值123放到EAX寄存器中，EAX通常用来存放返回值，第二条指令是RET，返回到调用者。调用者会从EAX寄存器中获取结果。

##2.2 ARM

在ARM平台上有一些不同：

```
f PROC
	MOV r0, #0x7b ; 123
	BX lr
	ENDP
```

ARM使用寄存器R0来返回函数的结果，所以123被复制到R0。

在ARM架构中返回地址没有保存在本地栈中，而是在寄存器里。所以 BX lr 指令是执行流程跳转到调用者的执行流程中。
值得注意的是MOV在x86和ARM架构中都是一个会令人误解的名字，数据实际上并不是被移动而是被复制。

#2.3 MIPS

MIPS在命名寄存器时有两个约定的规则：使用数字（从$0到$31）或者使用假名($V0, $A0等)。GCC汇编输出使用数字命名寄存器：

```cpp
j  $31
li $2,123 # 0x7b
```
而IDA使用它们的假名：

```cpp
jr $ra
li $v0, 0x7B
```

