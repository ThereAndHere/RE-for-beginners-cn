#第一章 CPU简介

CPU是执行程序机器码的设备

**词汇表：**
**指令：** 原始的CPU命令。最简单的例子包括：在寄存器之间移动数据，内存操作和简单的运算。通常来说，每种CPU都有他自己的指令集架构（Instruction set architecture (ISA)）。
**汇编语言：** 助记词和一些类似宏的扩展，使编码更加容易。
**CPU 寄存器：** 每个CPU都有一组固定的通用寄存器（general purpose registers (GPR)）。x86有8个，x86-64有16个，ARM有16个。可以把寄存器理解为一个无类型的临时变量。想像一下你正在使用高级编程语言而且只能使用8个32位（或64位）的变量。只是用这些寄存器就能完成许多事。

有人可能会奇怪机器码和高级语言为什么会有不同。答案就是人类和CPU并不相同，对于人类来说很容易理解高级语言，比如C/C++，java，python等等。但是CPU更容易理解更低的抽象级别。也许可能发明出可以执行高级语言的CPU，但它会比目前的CPU复杂好几倍。类似的，对人类来说编写汇编语言非常不方便，因为它太低级了，很容易出现大量的错误。把高级语言转换成汇编语言的程序叫做编译器（Complier）。

##1.1 关于不同的指令集架构
x86架构使用变长操作码，所以当64位时代来临时，64位扩展并没有给它带来很大的冲击。实际上，x86架构还包含这一些最早出现在16位8086 CPU上的指令，还可以在现在的CPU上找到。

ARM是一种精简指令集CPU，采用定长操作码，这在早期有一些优势。在很早的时候，所有ARM指令被编码成4字节，现在被称为"ARM mode"。
后来人们发现它并不像一开始所想的那样节俭，实际上，现实中大部分使用的CPU指令可以使用更少的信息编码。所以人们增加了另一种指令集，叫做Thumb，可以把指令编码为2字节，现在被称为“Thumb mode”。然而，并不是所有的ARM指令都能被编码位2字节，所以Thumb指令集会受到一些限制。值得注意的是，代码可以编译为ARM和Thumb在一个程序中共存。
ARM的创造者认为Thumb可以被扩展，在ARMv7中带来了Thumb-2。Thumb-2还是使用2字节指令，但还有一些新的4字节指令。有一个常见的误解是Thumb-2是ARM和Thumb和混合。这是不对的。Thumb-2可以完全支持所有处理器特性，所以它可以同ARM mode竞争——这个目标显然是达到了，多数的iPod/iPhone/iPad程序被编译为Thumb-2指令集（很明显是因为Xcode默认这么做）。接着64位ARM出现了。该架构有4字节操作码，不需要额外的Thumb模式。因为64位的需求，造成我们现在有3种ARM指令集：ARM模式，Thumb模式（包括Thumb-2）和ARM64。这些指令集有部分交集，但它们是不同的指令集，而不是同一种指令集的不同形式。所以我们在本书里会试着使用所有三种ARM指令集的代码。

同时，还有许多其他的精简指令集使用固定的32位操作码，比如MIPS，PowerPC和Alpha AXP。
